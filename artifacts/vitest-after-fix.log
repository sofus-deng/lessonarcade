
> lessonarcade@0.1.0 test /Users/eichi/World/Engine/Code/LessonArcade
> vitest run


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90m/Users/eichi/World/Engine/Code/LessonArcade[39m

 [32mâœ“[39m test/studio/voice-analytics-import-guards.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 41[2mms[22m[39m
[90mstderr[2m | test/studio/proxy-basic-auth.test.ts[2m > [22m[2mStudio Proxy Basic Auth[2m > [22m[2mwhen Basic Auth credentials are NOT configured[2m > [22m[2mshould allow access to /studio/voice-analytics without credentials in development
[22m[39mStudio Basic Auth credentials not configured. Allowing access for development.

 [32mâœ“[39m test/studio/proxy-basic-auth.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstderr[2m | test/voice/telemetry.test.ts[2m > [22m[2mVoice Telemetry[2m > [22m[2mJSONL Append Behavior[2m > [22m[2mshould handle missing directory gracefully
[22m[39mFailed to append telemetry event: Error: Directory creation failed
    at [90m/Users/eichi/World/Engine/Code/LessonArcade/[39mtest/voice/telemetry.test.ts:275:41
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90mfile:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m test/voice/analytics.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 34[2mms[22m[39m
[90mstderr[2m | test/voice/telemetry.test.ts[2m > [22m[2mVoice Telemetry[2m > [22m[2mError Handling[2m > [22m[2mshould handle telemetry failures gracefully
[22m[39mFailed to append telemetry event: Error: File system error
    at [90m/Users/eichi/World/Engine/Code/LessonArcade/[39mtest/voice/telemetry.test.ts:344:46
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90mfile:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:915:20

 [32mâœ“[39m test/voice/telemetry.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 45[2mms[22m[39m
[90mstderr[2m | test/voice/telemetry-endpoint.test.ts[2m > [22m[2mTelemetry Endpoint[2m > [22m[2mPOST /api/voice/telemetry[2m > [22m[2mshould handle server errors gracefully
[22m[39mTelemetry endpoint error: Error: Server error
    at Object.<anonymous> [90m(/Users/eichi/World/Engine/Code/LessonArcade/[39mtest/voice/telemetry-endpoint.test.ts:159:15[90m)[39m
    at Object.Mock [as checkLimit] [90m(file:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+spy@4.0.16/node_modules/[4m@vitest/spy[24m/dist/index.js:285:34[90m)[39m
    at Module.POST [90m(/Users/eichi/World/Engine/Code/LessonArcade/[39mapp/api/voice/telemetry/route.ts:11:50[90m)[39m
    at [90m/Users/eichi/World/Engine/Code/LessonArcade/[39mtest/voice/telemetry-endpoint.test.ts:183:30
    at [90mfile:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///Users/eichi/World/Engine/Code/LessonArcade/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@4.0.16/node_modules/[4m@vitest/runner[24m/dist/index.js:1653:37

[90mstderr[2m | test/voice/telemetry-endpoint.test.ts[2m > [22m[2mTelemetry Endpoint[2m > [22m[2mPOST /api/voice/telemetry[2m > [22m[2mshould not expose stack traces or internal errors
[22m[39mTelemetry endpoint error: Error: Internal error
    at test.js:123:45

 [32mâœ“[39m test/voice/telemetry-endpoint.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 30[2mms[22m[39m
 [31mâ¯[39m test/demo/demo-lessons-validation.test.ts [2m([22m[2m50 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 56[2mms[22m[39m
     [32mâœ“[39m has expected number of demo lessons registered[32m 1[2mms[22m[39m
     [32mâœ“[39m contains all expected demo slugs[32m 1[2mms[22m[39m
     [32mâœ“[39m validates demo lesson "react-hooks-intro" against Zod schema[32m 3[2mms[22m[39m
     [32mâœ“[39m validates demo lesson "effective-meetings" against Zod schema[32m 1[2mms[22m[39m
     [32mâœ“[39m validates demo lesson "design-feedback-basics" against Zod schema[32m 1[2mms[22m[39m
     [32mâœ“[39m validates demo lesson "decision-making-uncertainty" against Zod schema[32m 0[2mms[22m[39m
     [32mâœ“[39m validates demo lesson "feedback-that-lands" against Zod schema[32m 1[2mms[22m[39m
     [32mâœ“[39m validates demo lesson "effective-one-on-ones" against Zod schema[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "react-hooks-intro" has required top-level fields[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-meetings" has required top-level fields[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "design-feedback-basics" has required top-level fields[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "decision-making-uncertainty" has required top-level fields[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "feedback-that-lands" has required top-level fields[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-one-on-ones" has required top-level fields[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "react-hooks-intro" has valid levels structure[32m 3[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-meetings" has valid levels structure[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "design-feedback-basics" has valid levels structure[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "decision-making-uncertainty" has valid levels structure[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "feedback-that-lands" has valid levels structure[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-one-on-ones" has valid levels structure[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "react-hooks-intro" contains mixed item types[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-meetings" contains mixed item types[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "design-feedback-basics" contains mixed item types[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "decision-making-uncertainty" contains mixed item types[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "feedback-that-lands" contains mixed item types[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-one-on-ones" contains mixed item types[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "react-hooks-intro" has valid multiple choice items[32m 2[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-meetings" has valid multiple choice items[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "design-feedback-basics" has valid multiple choice items[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "decision-making-uncertainty" has valid multiple choice items[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "feedback-that-lands" has valid multiple choice items[32m 6[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-one-on-ones" has valid multiple choice items[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "react-hooks-intro" has valid open ended items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-meetings" has valid open ended items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "design-feedback-basics" has valid open ended items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "decision-making-uncertainty" has valid open ended items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "feedback-that-lands" has valid open ended items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-one-on-ones" has valid open ended items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "react-hooks-intro" has valid checkpoint items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-meetings" has valid checkpoint items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "design-feedback-basics" has valid checkpoint items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "decision-making-uncertainty" has valid checkpoint items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "feedback-that-lands" has valid checkpoint items[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-one-on-ones" has valid checkpoint items[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m demo lesson "react-hooks-intro" has bilingual I18nText support[39m[32m 16[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-meetings" has bilingual I18nText support[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m demo lesson "design-feedback-basics" has bilingual I18nText support[39m[32m 1[2mms[22m[39m
     [32mâœ“[39m demo lesson "decision-making-uncertainty" has bilingual I18nText support[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "feedback-that-lands" has bilingual I18nText support[32m 0[2mms[22m[39m
     [32mâœ“[39m demo lesson "effective-one-on-ones" has bilingual I18nText support[32m 0[2mms[22m[39m
[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mrenders the correct title for not_found kind
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mrenders the correct title for not_found kind
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mrenders the correct title for schema_invalid kind
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mrenders the correct title for schema_invalid kind
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mhides debug details by default in production mode
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mhides debug details by default in production mode
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mshows debug details when debug prop is true
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mshows debug details when debug prop is true
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mrenders the 'Back to Demos' button with correct link
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

 [32mâœ“[39m test/lessonarcade/loaders-by-slug.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m test/demo/design-feedback-lesson.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mâœ“[39m test/presskit/presskit.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 860[2mms[22m[39m
 [32mâœ“[39m test/voice/chat-flow.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m test/voice/telemetry-emitter.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstderr[2m | test/lessonarcade/lesson-load-error-view.test.tsx[2m > [22m[2mLessonLoadErrorView[2m > [22m[2mrenders the 'Back to Demos' button with correct link
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

 [32mâœ“[39m test/lessonarcade/lesson-load-error-view.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[33m 643[2mms[22m[39m
     [33m[2mâœ“[22m[39m renders the 'Back to Demos' button with correct link [33m 584[2mms[22m[39m
 [32mâœ“[39m test/voice/analytics-privacy.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 6[2mms[22m[39m
[90mstderr[2m | test/voice/voice-chat-flow-ui.test.tsx[2m > [22m[2mVoice Chat Flow UI[2m > [22m[2mrenders without crashing
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/voice/voice-chat-flow-ui.test.tsx[2m > [22m[2mVoice Chat Flow UI[2m > [22m[2mrenders without crashing
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/voice/voice-chat-flow-ui.test.tsx[2m > [22m[2mVoice Chat Flow UI[2m > [22m[2mdoes not autoplay on mount
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/voice/voice-chat-flow-ui.test.tsx[2m > [22m[2mVoice Chat Flow UI[2m > [22m[2mdoes not autoplay on mount
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/voice/voice-chat-flow-ui.test.tsx[2m > [22m[2mVoice Chat Flow UI[2m > [22m[2mdoes not persist specific answers in localStorage
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

[90mstderr[2m | test/voice/voice-chat-flow-ui.test.tsx[2m > [22m[2mVoice Chat Flow UI[2m > [22m[2mdoes not persist specific answers in localStorage
[22m[39mAn update to Root inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

 [32mâœ“[39m test/voice/voice-chat-flow-ui.test.tsx [2m([22m[2m3 tests[22m[2m)[22m[32m 26[2mms[22m[39m
 [32mâœ“[39m test/lessonarcade/lesson-load-error.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m test/voice/chunk-text.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m test/voice/build-script.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m test/voice/tts-dedupe.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m test/voice/presets.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32mâœ“[39m test/voice/rate-limiter-minute.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [32mâœ“[39m test/smoke.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 2[2mms[22m[39m
 [32mâœ“[39m test/scripts/cloud-run-smoke.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 1[2mms[22m[39m
 [32mâœ“[39m test/demo/demo-lesson-grid-link.test.ts [2m([22m[2m1 test[22m[2m)[22m[32m 2[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 2 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m test/demo/demo-lessons-validation.test.ts[2m > [22mDemo Lessons Schema Validation[2m > [22mdemo lesson "react-hooks-intro" has bilingual I18nText support
[41m[1m FAIL [22m[49m test/demo/demo-lessons-validation.test.ts[2m > [22mDemo Lessons Schema Validation[2m > [22mdemo lesson "design-feedback-basics" has bilingual I18nText support
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m test/demo/demo-lessons-validation.test.ts:[2m190:25[22m[39m
    [90m188| [39m    
    [90m189| [39m    [90m// At least some items should have i18n support[39m
    [90m190| [39m    [34mexpect[39m(hasI18nText)[33m.[39m[34mtoBe[39m([35mtrue[39m)
    [90m   | [39m                        [31m^[39m
    [90m191| [39m  })
    [90m192| [39m})

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/2]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m22 passed[39m[22m[90m (23)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m236 passed[39m[22m[90m (238)[39m
[2m   Start at [22m 18:10:31
[2m   Duration [22m 3.46s[2m (transform 1.84s, setup 3.61s, import 4.08s, tests 1.85s, environment 14.80s)[22m

â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
